{"ast":null,"code":"import React,{useEffect,useState}from\"react\";import{translations}from\"../../translations\";import{Box,Button,Typography,LinearProgress,Card,CardContent,CardMedia,Divider,Stack,Paper,Modal,Alert,Slider,List,ListItem}from\"@mui/material\";import{LayoutContext}from\"../LayoutContext\";import{UserContext}from\"../UserContext\";import{LoadingPage}from\"../LoadingPage\";import{ThemeContext}from\"@emotion/react\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";export function Shop(){const layout=React.useContext(LayoutContext);const settings=React.useContext(UserContext);const theme=React.useContext(ThemeContext);const[isTeamShop,setIsTeamShop]=useState(false);const[showContributionModal,setShowContributionModal]=useState(false);return/*#__PURE__*/_jsx(Stack,{direction:\"column\",sx:{height:window.innerHeight-layout.headerAppBarHeight-layout.navigationBarHeight,paddingTop:\"\".concat(layout.headerAppBarHeight,\"px\")},className:\"Shop\",children:/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"h5\",gutterBottom:true,sx:{textAlign:\"left\",fontWeight:\"bold\",margin:2,padding:1},children:translations[settings.language].shopWelcome}),/*#__PURE__*/_jsx(Divider,{}),/*#__PURE__*/_jsxs(Box,{sx:{display:\"flex\",justifyContent:\"center\",gap:\"16px\",margin:2,padding:1},children:[/*#__PURE__*/_jsx(Button,{variant:\"contained\",color:isTeamShop?\"default\":\"secondary\",onClick:()=>setIsTeamShop(false),sx:{textTransform:\"none\",fontSize:\"16px\",fontWeight:\"bold\",padding:\"12px 24px\",color:theme.palette.contrastText},children:translations[settings.language].shopIndiv}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",color:isTeamShop?\"secondary\":\"default\",onClick:()=>setIsTeamShop(true),sx:{textTransform:\"none\",fontSize:\"16px\",fontWeight:\"bold\",padding:\"12px 24px\",color:theme.palette.contrastText},children:translations[settings.language].shopTeam})]}),/*#__PURE__*/_jsxs(Box,{sx:{textAlign:\"center\",marginBottom:\"32px\",backgroundColor:\"#fff\",padding:2,margin:2,borderRadius:\"16px\",boxShadow:\"0 8px 16px rgba(0, 0, 0, 0.2)\"},children:[/*#__PURE__*/_jsxs(Typography,{variant:\"h6\",sx:{fontWeight:\"bold\",marginBottom:\"8px\"},children:[translations[settings.language].shopPoints,\" \",settings.points]}),/*#__PURE__*/_jsx(Box,{sx:{width:\"100%\",maxWidth:400,margin:\"0 auto\"},children:/*#__PURE__*/_jsx(LinearProgress,{variant:\"determinate\",value:Math.min(1000,settings.points)/1000*100,sx:{height:12,borderRadius:\"6px\",backgroundColor:\"#e0e0e0\",\"& .MuiLinearProgress-bar\":{backgroundColor:theme.palette.secondary.main}}})})]}),/*#__PURE__*/_jsx(Divider,{}),isTeamShop?/*#__PURE__*/_jsx(TeamShop,{setShowContributionModal:setShowContributionModal,showContributionModal:showContributionModal}):/*#__PURE__*/_jsx(EinzelShop,{}),/*#__PURE__*/_jsx(Box,{sx:{textAlign:\"center\",padding:3,backgroundColor:\"#e3f2fd\",borderRadius:\"8px\",boxShadow:\"0 4px 8px rgba(0, 0, 0, 0.2)\"},children:/*#__PURE__*/_jsx(Typography,{variant:\"body2\",children:\"\\xA9 2025 WorkBalance | Alle Rechte vorbehalten.\"})})]})});}// Einzelshop-Komponente\nfunction EinzelShop(){const settings=React.useContext(UserContext);const[angebotsDaten,setAngebotsDaten]=useState([]);const[modalErrorText,setModalErrorText]=useState({});const[showRewardModal,setShowRewardModal]=useState(false);const[selectedReward,setSelectedReward]=useState(0);const[isLoading,setIsLoading]=useState(false);useEffect(()=>{setIsLoading(true);getSingleShopData();},[]);const getSingleShopData=()=>{fetch(\"/api/shop\",{method:\"POST\",headers:{Accept:\"application/json\",\"Content-Type\":\"application/json\"},body:JSON.stringify({language:settings.language})}).then(res=>res.json()).then(data=>{setAngebotsDaten(data.content);setIsLoading(false);}).catch(err=>console.error(\"Error fetching shop data:\",err));};const handleBuyReward=id=>{fetch(\"/api/shop/single/buy\",{method:\"POST\",body:JSON.stringify({id:id,user_id:settings.userID,language:settings.language}),headers:{\"Content-Type\":\"application/json\"}}).then(res=>res.json()).then(data=>{if(data.type===\"success\"){settings.setPoints(data.points);setModalErrorText(data);getSingleShopData();}else{setModalErrorText(data);setTimeout(()=>{setModalErrorText(\"\");},5000);}});};return isLoading?/*#__PURE__*/_jsx(LoadingPage,{}):/*#__PURE__*/_jsxs(Stack,{direction:\"column\",sx:{overflowY:\"auto\",backgroundColor:\"#e8e8e8\"},paddingTop:2,children:[showRewardModal&&/*#__PURE__*/_jsx(RewardModal,{id:selectedReward,angebotsDaten:angebotsDaten,showModal:showRewardModal,setShowModal:setShowRewardModal,handleBuyReward:handleBuyReward,modalErrorText:modalErrorText,setModalErrorText:setModalErrorText}),angebotsDaten.map((category,index)=>/*#__PURE__*/_jsxs(Box,{sx:{marginBottom:2},children:[/*#__PURE__*/_jsxs(Typography,{variant:\"h6\",gutterBottom:true,sx:{fontWeight:\"bold\",marginBottom:0},children:[category.category,\" \",translations[settings.language].shopPoints]}),/*#__PURE__*/_jsx(Stack,{direction:\"row\",sx:{overflowY:\"hidden\",padding:3},spacing:3,children:category.rewards.map(reward=>/*#__PURE__*/_jsx(RewardCard,{id:reward.id,color:reward.color,image:reward.image,value:reward.value,label:reward.label,setShowModal:setShowRewardModal,setSelectedReward:setSelectedReward},reward.id))})]},index))]});}// Teamshop-Komponente\nfunction TeamShop(_ref){let{showContributionModal,setShowContributionModal}=_ref;const[selectedContribution,setSelectedContribution]=useState(0);const[teamShopDaten,setTeamShopDaten]=useState([]);const[teamModalErrorMessage,setTeamModalErrorMessage]=useState(\"\");const handleContrubutionClick=(event,key)=>{setShowContributionModal(true);setSelectedContribution(teamShopDaten.find(e=>e.id===key));};const[contribution,setContribution]=useState(0);const settings=React.useContext(UserContext);const theme=React.useContext(ThemeContext);const getTeamShopData=React.useCallback(()=>{fetch(\"/api/teamshop\",{method:\"POST\",headers:{Accept:\"application/json\",\"Content-Type\":\"application/json\"},body:JSON.stringify({section_id:settings.sectionID,language:settings.language})}).then(res=>res.json()).then(data=>{setTeamShopDaten(data);}).catch(error=>console.log(error));},[settings.sectionID]);const handleContributeReward=id=>{fetch(\"/api/teamshop/buy\",{method:\"POST\",body:JSON.stringify({id:id,user_id:settings.userID,contribution:contribution}),headers:{\"Content-Type\":\"application/json\"}}).then(res=>res.json()).then(data=>{if(data.status===\"success\"){settings.setPoints(data.points);setShowContributionModal(false);getTeamShopData();}else{setTeamModalErrorMessage(data.message);setTimeout(()=>{setTeamModalErrorMessage(\"\");},5000);}});};const handleContributionChange=event=>{setContribution(event.target.value);};useEffect(()=>{getTeamShopData();},[getTeamShopData]);return/*#__PURE__*/_jsxs(_Fragment,{children:[showContributionModal&&/*#__PURE__*/_jsx(Modal,{sx:{height:\"100vh\",margin:1,display:\"flex\",alignItems:\"center\",justifyContent:\"center\",zIndex:9999},open:showContributionModal,children:/*#__PURE__*/_jsx(Paper,{elevation:1,sx:{display:\"flex\",alignItems:\"center\",padding:2,justifyContent:\"space-between\"},children:/*#__PURE__*/_jsxs(Stack,{spacing:2,direction:\"column\",sx:{width:\"100%\",alignItems:\"center\"},children:[/*#__PURE__*/_jsxs(Typography,{variant:\"h6\",sx:{fontWeight:\"bold\"},children:[translations[settings.language].shopQuestion1,\" \",selectedContribution.beschreibung,\" \",translations[settings.language].shopQuestion2,\"?\"]}),/*#__PURE__*/_jsx(Box,{sx:{flexGrow:1,width:\"90%\"},children:/*#__PURE__*/_jsx(Slider,{min:0,onChange:handleContributionChange,defaultValue:contribution,value:contribution,max:Math.min(parseInt(selectedContribution.kosten)-parseInt(selectedContribution.aktuellerStand),settings.points),valueLabelDisplay:\"auto\",step:10})}),/*#__PURE__*/_jsxs(Stack,{direction:\"row\",spacing:2,children:[/*#__PURE__*/_jsxs(Button,{variant:\"contained\",onClick:()=>handleContributeReward(selectedContribution.id),children:[\" \",translations[settings.language].confirm]}),/*#__PURE__*/_jsxs(Button,{variant:\"contained\",onClick:()=>setShowContributionModal(false),children:[\" \",translations[settings.language].close]})]}),teamModalErrorMessage&&/*#__PURE__*/_jsx(Alert,{severity:\"error\",children:teamModalErrorMessage})]})})}),/*#__PURE__*/_jsx(Box,{sx:{backgroundColor:\"#e8e8e8\"},children:/*#__PURE__*/_jsx(List,{children:teamShopDaten.map((item,index)=>/*#__PURE__*/_jsx(ListItem,{sx:{flexGrow:1},children:/*#__PURE__*/_jsx(Paper,{elevation:1,sx:{flexGrow:1,padding:2,margin:0,borderRadius:\"16px\",boxShadow:\"0 8px 16px rgba(0, 0, 0, 0.2)\"},children:/*#__PURE__*/_jsxs(Stack,{direction:\"column\",justifyContent:\"center\",spacing:2,children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",sx:{flexGrow:1,fontWeight:\"bold\",marginBottom:\"8px\"},children:item.text}),/*#__PURE__*/_jsx(Box,{sx:{width:\"100%\",maxWidth:400,margin:\"0 auto\"},children:/*#__PURE__*/_jsx(LinearProgress,{variant:\"determinate\",value:item.aktuellerStand/item.kosten*100,sx:{height:12,borderRadius:\"6px\",backgroundColor:\"#e0e0e0\",\"& .MuiLinearProgress-bar\":{backgroundColor:theme.palette.primary.main}}})}),/*#__PURE__*/_jsxs(Typography,{variant:\"body1\",sx:{fontSize:\"20px\",fontWeight:\"bold\",textAlign:\"center\",marginTop:\"8px\"},children:[item.aktuellerStand,\"/\",item.kosten,\" \",translations[settings.language].shopPoints]}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",disabled:item.aktuellerStand>=item.kosten,onClick:e=>{handleContrubutionClick(e,item.id);},children:translations[settings.language].contribute})]})})},index))})})]});}// RewardCard\nfunction RewardCard(_ref2){let{id,color,image,value,label,setShowModal,setSelectedReward}=_ref2;const handleRewardClick=e=>{setShowModal(true);setSelectedReward(id);};return/*#__PURE__*/_jsx(Box,{direction:\"column\",sx:{width:\"100%\"},children:/*#__PURE__*/_jsxs(Card,{sx:{backgroundColor:color,textAlign:\"center\",borderRadius:\"16px\",boxShadow:\"0 8px 16px rgba(0, 0, 0, 0.2)\",transition:\"transform 0.3s ease\",\"&:hover\":{transform:\"scale(1.05)\"}},onClick:handleRewardClick,children:[/*#__PURE__*/_jsx(CardMedia,{component:\"img\",height:\"60\",image:image,alt:label,sx:{objectFit:\"contain\",marginTop:1}}),/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",fontWeight:\"bold\",textAlign:\"center\",sx:{marginBottom:\"8px\"},children:label}),/*#__PURE__*/_jsx(Typography,{variant:\"body1\",textAlign:\"center\",sx:{fontSize:\"1.5rem\",fontWeight:\"bold\",color:\"#333\"},children:value})]})]})});}function RewardModal(_ref3){let{id,angebotsDaten,showModal,setShowModal,handleBuyReward,modalErrorText,setModalErrorText}=_ref3;const category=angebotsDaten.find(category=>category.rewards.find(reward=>reward.id===id));const reward=category.rewards.find(reward=>reward.id===id);const settings=React.useContext(UserContext);return/*#__PURE__*/_jsx(Modal,{sx:{height:\"100vh\",margin:1,display:\"flex\",alignItems:\"center\",justifyContent:\"center\",zIndex:9999},open:showModal,children:/*#__PURE__*/_jsx(Paper,{elevation:1,sx:{display:\"flex\",alignItems:\"center\",padding:2,justifyContent:\"space-between\"},children:/*#__PURE__*/_jsxs(Stack,{direction:\"column\",sx:{width:\"100%\",alignItems:\"center\"},children:[/*#__PURE__*/_jsx(\"img\",{src:reward.image,alt:\"Reward\",width:\"40%\"}),/*#__PURE__*/_jsx(Typography,{variant:\"h6\",sx:{fontWeight:\"bold\"},children:reward.label}),/*#__PURE__*/_jsxs(Stack,{direction:\"row\",spacing:2,children:[!(modalErrorText.type===\"success\")&&/*#__PURE__*/_jsx(Button,{variant:\"contained\",onClick:()=>handleBuyReward(id),children:translations[settings.language].confirm}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",onClick:()=>{setShowModal(false);setModalErrorText({});},children:translations[settings.language].close})]}),modalErrorText.type&&/*#__PURE__*/_jsx(Alert,{sx:{margin:1},severity:modalErrorText.type,children:modalErrorText.message})]})})});}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}